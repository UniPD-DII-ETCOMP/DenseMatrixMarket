function Vext=fun_compute_ext_field_dual_edge_dot_tetra(NN,nFaces,FP,fsh,nf_sh,fnsh,nf_nsh,Field_ext,np)
% np= from 2 to 16

Vext=zeros(nFaces,1);

for k=1:nf_sh
    points_pos=NN(:,FP([1,3,2,4],fsh(k)));
    points_neg=NN(:,FP([1,2,3,5],fsh(k)));
    points_fac=NN(:,FP([1,2,3],fsh(k)));

    p_pos=sum(points_pos,2)/4;
    p_neg=sum(points_neg,2)/4;
    p_fac=sum(points_fac,2)/3;
    
    vec1=p_fac-p_pos;
    [PPg_pos,wg1,~]=Gauss_line_nvar([p_fac,p_pos],np);
    res_1=0;
    for ii = 1:np
        res_1=res_1+0.5*wg1(ii)*dot(Field_ext(PPg_pos(1,ii),PPg_pos(2,ii),PPg_pos(3,ii))',vec1);
    end
    
    vec2=p_neg-p_fac;
    [PPg_neg,wg2,~]=Gauss_line_nvar([p_neg,p_fac],np);
    res_2=0;
    for ii = 1:np
        res_2=res_2+0.5*wg2(ii)*dot(Field_ext(PPg_neg(1,ii),PPg_neg(2,ii),PPg_neg(3,ii))',vec2);
    end
    
    Vext(fsh(k))=res_1+res_2;
    
end

for k=1:nf_nsh
    points_pos=NN(:,FP([1,3,2,4],fnsh(k)));
    points_fac=NN(:,FP([1,2,3],fnsh(k)));

    p_pos=sum(points_pos,2)/4;
    p_fac=sum(points_fac,2)/3;
    
    vec1=p_fac-p_pos;
    [PPg_pos,wg1,~]=Gauss_line_nvar([p_fac,p_pos],np);
    res_1=0;
    for ii = 1:np
        res_1=res_1+0.5*wg1(ii)*dot(Field_ext(PPg_pos(1,ii),PPg_pos(2,ii),PPg_pos(3,ii))',vec1);
    end
    Vext(fnsh(k))=res_1;
end
    
end



function [PPg,wg,ll]=Gauss_line_nvar(NN,np)

gauss_weights=[1.000000000000000,0.888888888888889,0.652145154862546,0.568888888888889,0.467913934572691,0.417959183673469,0.362683783378362,0.330239355001260,0.295524224714753,0.272925086777901,0.249147045813403,0.232551553230874,0.215263853463158,0.202578241925561,0.189450610455069;...
0.000000000000000,0.555555555555556,0.347854845137454,0.478628670499366,0.360761573048139,0.381830050505119,0.313706645877887,0.312347077040003,0.269266719309996,0.262804544510247,0.233492536538355,0.226283180262897,0.205198463721290,0.198431485327111,0.182603415044924;...
0.000000000000000,0.000000000000000,0.000000000000000,0.236926885056189,0.171324492379170,0.279705391489277,0.222381034453374,0.260610696402935,0.219086362515982,0.233193764591990,0.203167426723066,0.207816047536889,0.185538397477938,0.186161000015562,0.169156519395003;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.129484966168870,0.101228536290376,0.180648160694857,0.149451349150581,0.186290210927734,0.160078328543346,0.178145980761946,0.157203167158194,0.166269205816994,0.149595988816577;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.081274388361574,0.066671344308688,0.125580369464905,0.106939325995318,0.138873510219787,0.121518570687903,0.139570677926154,0.124628971255534;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.055668567116174,0.047175336386512,0.092121499837728,0.080158087159760,0.107159220467172,0.095158511682493;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.040484004765316,0.035119460331752,0.070366047488108,0.062253523938648;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.030753241996117,0.027152459411754];

gauss_points=[0.577350269189626,0.000000000000000,0.339981043584856,0.000000000000000,0.238619186083197,0.000000000000000,0.183434642495650,0.000000000000000,0.148874338981631,0.000000000000000,0.125333408511469,0.000000000000000,0.108054948707344,0.000000000000000,0.095012509837637;...
0.000000000000000,0.774596669241483,0.861136311594050,0.538469310105683,0.661209386466265,0.405845151377397,0.525532409916329,0.324253423403809,0.433395394129247,0.269543155952345,-0.367831498918180,0.230458315955135,0.319112368927890,0.201194093997435,0.281603550779259;...
0.000000000000000,0.000000000000000,0.000000000000000,0.906179845938664,0.932469514203152,0.741531185599394,0.796666477413627,0.613371432700590,0.679409568299024,0.519096129110681,0.587317954286617,0.448492751036447,0.515248636358154,0.394151347077563,0.458016777657227;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.949107912342759,0.960289856497536,0.836031107326636,0.865063366688985,0.730152005574049,0.769902674194305,0.642349339440340,0.687292904811685,0.570972172608539,0.617876244402644;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.968160239507626,0.973906528517172,0.887062599768095,0.904117256370475,0.801578090733310,0.827201315069765,0.724417731360170,0.755404408355003;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.978228658146057,0.981560634246719,0.917598399222978,0.928434883663574,0.848206583410427,0.865631202387832;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.984183054718588,0.986283808696812,0.937273392400706,0.944575023073233;...
0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.000000000000000,0.987992518020485,0.989400934991650];

ll = norm(NN(:,2)-NN(:,1));

if mod(np,2)==0 %even number of points
    pg = [gauss_points(1:np/2,np-1)',-gauss_points(1:np/2,np-1)'];
    wg = [gauss_weights(1:np/2,np-1)',gauss_weights(1:np/2,np-1)'];
elseif mod(np,2)==1 %odd
    pg = [gauss_points(1,np-1),gauss_points(2:(np+1)/2,np-1)',-gauss_points(2:(np+1)/2,np-1)'];
    wg = [gauss_weights(1,np-1),gauss_weights(2:(np+1)/2,np-1)',gauss_weights(2:(np+1)/2,np-1)'];
end
PPg = repmat(NN(:,1),1,np)+repmat(0.5*(NN(:,2)-NN(:,1)),1,np).*repmat((1+pg),3,1);

end